<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../static/style.css">
    <title>Join Game</title>
</head>

<body id="room">
    
<section id="room-section"> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> 

   <div class="login"> 

    <div class="content"> 

     <h2 id="room-h2">Join Game</h2> 
     <h3 id="room-h3">
        *To start a new game: Click on Create Room!<br>
        * To join a game: Enter the Room ID below, then click on Join Room
     </h3>

     <form id="roomForm" method="POST" class="form"> 

      <div class="inputBox"> 
        <input type="text" name="code"> <i>Room Id</i> 
      </div> 

      <div class="inputBox"> 
        <input type="submit" name="join" value="Join Room">
      </div> 

      <div class="inputBox"> 
        <input type="submit" name="create" value="Create a Room"> 
      </div> 

      {% if error %}
      <ul>
          <li id="error">{{error}}</li>
      </ul>
      {% endif %}
      <div id="message"></div> <!-- Element to display error messages -->
    </form> 

    </div> 

   </div> 

  </section>
    <script>
        document.getElementById('roomForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const formData = new FormData(this)
            const submitter = event.submitter
            const header = {
              'Authorization': `Bearer ${localStorage.getItem('token')}`,  // Correct format
              'Content-Type': 'application/json'
            }
            const body = {}
            
            if (submitter.name === 'join') {
                console.log("Join Room button clicked");
                const code = formData.get('code');
                if (!code){
                  alert("Room ID is required to join a room.");
                  return;
                }
                body.code = code
            }
            makeRequest('/room', HttpMethod.post, header, JSON.stringify(body))
            .then(data => {
              if (data.redirect) {
                console.log('redirect')
                window.open(data.redirect); ;
              }
              if(data.message){
                console.log('MESSSAGEW')
                console.log(data.message)
                showMessage(data.message)
              }
            })
            .catch(error => {
              console.error('Request failed:', error)
            });
        });

    </script>
  <script src="../static/request.js"></script>
 </body>
  
</html>